<!-- WORKBOARD DEBUG PAGE â€“ paste this into Web Page main section temporarily -->
<div id="wb-debug" style="font-family:monospace;padding:1rem;background:#f8fafc;min-height:200px;">
  <h3 style="margin-bottom:1rem;">WorkBoard Debug</h3>
  <div id="wb-log" style="display:flex;flex-direction:column;gap:0.5rem;"></div>
</div>

<script>
function log(msg, color) {
  var el = document.createElement('div');
  el.style.cssText = 'padding:0.5rem;border-radius:6px;background:'+(color||'#e2e8f0')+';font-size:13px;';
  el.textContent = msg;
  document.getElementById('wb-log').appendChild(el);
}

log('Script started');

// 1. Check frappe object
log('frappe defined: ' + (typeof frappe !== 'undefined'));
if (typeof frappe !== 'undefined') {
  log('frappe.csrf_token: ' + frappe.csrf_token);
  log('frappe.session: ' + JSON.stringify(frappe.session || null));
}

// 2. Check boot
log('frappe.boot: ' + (typeof frappe !== 'undefined' && frappe.boot ? JSON.stringify(Object.keys(frappe.boot)) : 'undefined'));

// 3. Try direct fetch with no CSRF
fetch('/api/method/frappe.auth.get_logged_user', {
  credentials: 'same-origin',
  headers: { 'Accept': 'application/json' }
})
.then(function(r) {
  log('get_logged_user HTTP status: ' + r.status, r.ok ? '#dcfce7' : '#fee2e2');
  return r.json();
})
.then(function(d) {
  log('get_logged_user response: ' + JSON.stringify(d), '#dcfce7');
})
.catch(function(e) {
  log('get_logged_user ERROR: ' + e.toString(), '#fee2e2');
});

// 4. Try get_list with no CSRF
fetch('/api/method/frappe.client.get_list?doctype=WB%20Task&fields=[%22name%22,%22assign_to%22]&limit_page_length=3', {
  credentials: 'same-origin',
  headers: { 'Accept': 'application/json' }
})
.then(function(r) {
  log('get_list HTTP status: ' + r.status, r.ok ? '#dcfce7' : '#fee2e2');
  return r.json();
})
.then(function(d) {
  log('get_list response: ' + JSON.stringify(d).substring(0, 200), '#dcfce7');
})
.catch(function(e) {
  log('get_list ERROR: ' + e.toString(), '#fee2e2');
});
</script>